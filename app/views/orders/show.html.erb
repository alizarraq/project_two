<%= render "shared/flash_messages" %>
<h2 class="text-center mt-4"><%= @order.title %></h2>

<div class="container">
  <div class="row justify-content-md-center">
    <div class="col-8 mt-4">
      <div class="card text-center shadow mb-5 bg-white rounded">
        <div class="card-header font-italic">
          by <%= @order.user.username if @order.user %>
          <%= link_to gravatar_for(@order.user), user_path(@order.user) %>
          <% if @order.categories.any? %>
            <div class="mt-2"><%= render @order.categories %></div> 
          <% end %>
        </div>
        <div class="card-body">
          <div class="card-text text-left"><%= simple_format(@order.descreption) %></div>
          <h6 class="card-text"><%= truncate(@order.location) %></h6>
          <h6 class="card-text"><%= @order.price %></h6>
          <% if logged_in? && (@order.user == current_user || current_user.admin?) %>
          <%= link_to "Edit", edit_order_path(@order), class: "btn btn-outline-info", data: {confirm: "Are you sure?"} %>
          <%= link_to "Delete", order_path(@order), class: "btn btn-outline-danger", method: :delete, data: {confirm: "Are you sure?"} %>
          <% end %>
        </div>
        <div class="card-footer text-muted">
          <small>Created <%= time_ago_in_words(@order.created_at) %> ago, 
          edited <%= time_ago_in_words(@order.updated_at) %> ago</small>
        </div>
      </div>
    </div>
  </div>
</div>
  <% @order.images.each do |image| %>
    <div><%= image_tag%></div>
  <% end %>

<h2 class="text-center mt-4">Offers</h2>

<div class="container">
  <% @order.comments.each do |comment| %>
    <div class="row justify-content-md-center">
      <div class="col-8 mt-4">
        <div class="card text-center shadow mb-5 bg-white rounded">
          <div class="card-header font-italic">
            <h3>by <%= link_to comment.worker.username, user_path(comment.worker) %></h3>
          </div>
          <div class="card-body"> 
            <p class="card-text"><%= comment.content %></p>
            <p class="card-text"><%= comment.price %></p>
            <p class="card-text"><%= comment.date.to_s %></p>
            <%= form_with model: comment, url: comment_path(comment), method: :patch do |form| %>
            <% if logged_in? && (@order.user == current_user ) %>
              <%= form.submit "Approve" %>
              <%= form.submit "Decline" %>
            <% end %>
            <%end %>
          </div>
        </div>
      </div>
    </div>
  <%end %>
</div>

<%if current_user.worker? || current_user.admin?%>
<div class="container ">
  <div class="row justify-content-md-center">
    <div class="col-8 mt-4">
    <%= render 'shared/errors', obj: @comment %>
      <%= form_with model: [@order, @comment], url: order_comments_path(@order), local: true do |form| %>
        <div class="form-group">
          <%= form.label :content %>
          <%= form.text_area :content, class: "form-control" %>
        </div>
        <div class="form-group">
          <%= form.label :price %>
          <%= form.text_field :price, class: "form-control" %>
        </div>
        <div class="form-group">
          <%= form.label :date %>
          <%= form.date_select :date, class: "form-control" %>
        </div>
        <%= form.submit "Make offer", class: "btn btn-primary" %>
      <% end %>
      </div>
    </div>
</div>
<%end%>

